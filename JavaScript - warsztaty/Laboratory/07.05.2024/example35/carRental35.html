<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Car Rental Form</title>
  <link rel="stylesheet" href="style/main.css">
</head>
<body>
<header class="top">
  <img id="headerLogo" src="https://static.tvtropes.org/pmwiki/pub/images/pimp_my_ride.png">
  <img id="XzIbiT" src="imag/pngegg.png">
</header>

<section id="main">
  <h1>Pimp My Ride</h1>
  <p>
    Pimp My Ride is an American television series produced by MTV and hosted by rapper Xzibit, which ran for six seasons on MTV from 2004 to 2007. In each episode, a car in poor condition is both restored and customized. The work on the show was done by West Coast Customs until season 5 and was done by Galpin Auto Sports thereafter.
  </p>

</section>

<div id="Form">
  <h2>Send me your form</h2>
  <form id="rentalForm">
    <label for="vehicleMake">Car make:</label><br>
    <input type="text" id="vehicleMake" name="vehicleMake"><br>

    <label for="rentedModel">Model:</label><br>
    <input type="text" id="rentedModel" name="rentedModel   "><br>

    <label for="registrationNumberReturn">Registration number:</label><br>
    <input type="text" id="registrationNumberReturn" name="registrationNumberReturn"><br>

    <label for="dateYearOfProduction">Year of production</label><br>
    <input type="date" id="dateYearOfProduction" name="dateYearOfProduction"><br>

    <label for="VIN">VIN</label><br>
    <input type="text" id="VIN" name="VIN"><br><br>
    <button type="submit">Submit</button>
  </form>

  <footer>
    © 2024, Pimp my Rider MTV
    <br>
    All trademarks and registered trademarks appearing on
    this site are the property of their respective owners.
  </footer>


</div>
<script>
class CarRental {
    constructor(vehicleMake, rentedModel, registrationNumberReturn, dateYearOfProduction, VIN) {
    this.vehicleMake = vehicleMake;
    this.rentedModel = rentedModel;
    this.registrationNumberReturn = registrationNumberReturn;
    this.dateYearOfProduction = dateYearOfProduction;
    this.VIN = VIN;
    }
}


    let carRentals = [];
    let carRentalsJSON = "";
    let carIndex = 0;

    function handleSubmit(event) {
      event.preventDefault(); //

      const vehicleMake = document.getElementById('vehicleMake').value;
      const rentedModel = document.getElementById('rentedModel').value;
      const registrationNumberReturn = document.getElementById('registrationNumberReturn').value;
      const dateYearOfProduction = document.getElementById('dateYearOfProduction').value;
      const VIN = document.getElementById('VIN').value;

      const rentalInfo = new CarRental(vehicleMake,
              rentedModel, registrationNumberReturn, dateYearOfProduction, VIN);

      carRentals.push(rentalInfo);

      carRentals.forEach(function(obj) {
        console.log(obj)
        console.log(obj.vehicleRegistrationNumber)
      });

  
      carRentalsJSON = JSON.stringify(rentalInfo);

      localStorage.setItem('carRentals', carRentalsJSON);

      console.log(carRentalsJSON);

      // Wysyłamy obiekt carRentalData do serwera Node.js za pomocą metody POST
      fetch('http://localhost:8835/carRental', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(rentalInfo),
        })
        .then(response => response.text())
        .then(data => {
            console.log(data);
            alert('Car rental data sent successfully!');
            // Czyścimy formularz po wysłaniu danych
            form.reset();
        })
        .catch((error) => {
            console.error('Error:', error);
            alert('An error occurred while sending car rental data!');
        });


    }

    const form = document.getElementById('rentalForm');
    form.addEventListener('submit', handleSubmit);


    function displayDataInForm(data) {
      document.getElementById('vehicleRegistrationNumberDisplay').value = data.vehicleRegistrationNumber;
      document.getElementById('rentedDateDisplay').value = data.rentedDate;
      document.getElementById('dateOfReturnDisplay').value = data.dateOfReturn;
      document.getElementById('datePESELDisplay').value = data.dataPESEL;
      document.getElementById('dateLastNameDisplay').value = data.dateLastNameDisplay;
      document.getElementById('dateSecondNameDisplay').value = data.dateSecondName;

    }

    // Przypisanie danych JSON do formularza po naciśnięciu przycisku "Next"
    document.getElementById('nextButton').addEventListener('click', function() {
      // Parsowanie danych JSON
      let parsedData = JSON.parse(localStorage['carRentals']) || [];
      // Wyświetlenie danych w formularzu
      console.log(parsedData)
      displayDataInForm(parsedData[carIndex]);
      if (carIndex >=  parsedData.length -1) {
        carIndex = 0;
      } else {
        carIndex++;
      }
    });

    document.getElementById('getCarsRentalButton').addEventListener('click', function() {
      fetch('http://localhost:8835/getCarsRental')
      .then(response => response.json())
      .then(data => {
        // Przetwarzanie pobranych danych
        const carListElement = document.getElementById('carList');
        data.forEach(car => {
          const listItem = document.createElement('li');
          listItem.textContent = `Vehicle: ${car.vehicleRegistrationNumber}, Rented Date: ${car.rentedDate}, Return Date: ${car.dateOfReturn}`;
          carListElement.appendChild(listItem);
        });
      })
      .catch(error => console.error('Error fetching data:', error));
    });
    
</script>
</body>
</html>