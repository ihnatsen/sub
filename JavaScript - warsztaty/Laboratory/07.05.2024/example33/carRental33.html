<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Car Rental Form</title>
</head>
<body>
  <h2>Car Rental Form</h2>
  <form id="rentalForm">
    <label for="vehicleRegistrationNumber">Vehicle Registration Number:</label><br>
    <input type="text" id="vehicleRegistrationNumber" name="vehicleRegistrationNumber"><br>

    <label for="rentedDate">Rented Date:</label><br>
    <input type="date" id="rentedDate" name="rentedDate"><br>

    <label for="dateOfReturn">Date of Return:</label><br>
    <input type="date" id="dateOfReturn" name="dateOfReturn"><br><br>

    <label>PESEL:</label><br>
    <input type = "text" id="pesel" name="dataPesel"><br><br>

    <label>Imie:</label><br>
    <input type = "text" id="lastName" name="dataName"><br><br>


    <label>Nazwisko:</label><br>
    <input type = "text" id="secondName" name="dataSecondName"><br><br>

    <button type="submit">Submit</button>
  </form>

  <h2>Dislay Car Rentals Form</h2>
  <form id="displayRentalForm">
    <label for="vehicleRegistrationNumberDisplay">Vehicle Registration Number:</label><br>
    <input type="text" id="vehicleRegistrationNumberDisplay" name="vehicleRegistrationNumberDisplay"><br>

    <label for="rentedDateDisplay">Rented Date:</label><br>
    <input type="date" id="rentedDateDisplay" name="rentedDateDisplay"><br>

    <label for="dateOfReturnDisplay">Date of Return:</label><br>
    <input type="date" id="dateOfReturnDisplay" name="dateOfReturnDisplay"><br><br>

    <button type="button" id="nextButton">Next</button>
  </form>

  <script>
    // Definicja klasy CarRental
    class CarRental {
      constructor(vehicleRegistrationNumber, rentedDate, dateOfReturn) {
        this.vehicleRegistrationNumber = vehicleRegistrationNumber;
        this.rentedDate = rentedDate;
        this.dateOfReturn = dateOfReturn;
      }
    }

    let carRentals = [];
    let carRentalsJSON = "";
    let carIndex = 0;

    function handleSubmit(event) {
      event.preventDefault(); // Zapobiega domyślnej akcji przesyłania formularza

      const vehicleRegistrationNumber = document.getElementById('vehicleRegistrationNumber').value;
      const rentedDate = document.getElementById('rentedDate').value;
      const dateOfReturn = document.getElementById('dateOfReturn').value;

      const rentalInfo = new CarRental(vehicleRegistrationNumber, rentedDate, dateOfReturn);

      carRentals.push(rentalInfo);

      carRentals.forEach(function(obj) {
        console.log(obj)
        console.log(obj.vehicleRegistrationNumber)
      });

  
      carRentalsJSON = JSON.stringify(carRentals);

      localStorage.setItem('carRentals', carRentalsJSON);

      console.log(carRentalsJSON);

      // Wysyłamy obiekt carRentalData do serwera Node.js za pomocą metody POST
      fetch('http://localhost:8833/carRental', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(carRentals),
        })
        .then(response => response.text())
        .then(data => {
            console.log(data);
            alert('Car rental data sent successfully!');
            // Czyścimy formularz po wysłaniu danych
            form.reset();
        })
        .catch((error) => {
            console.error('Error:', error);
            alert('An error occurred while sending car rental data!');
        });


    }

    const form = document.getElementById('rentalForm');
    form.addEventListener('submit', handleSubmit);


    function displayDataInForm(data) {
      document.getElementById('vehicleRegistrationNumberDisplay').value = data.vehicleRegistrationNumber;
      document.getElementById('rentedDateDisplay').value = data.rentedDate;
      document.getElementById('dateOfReturnDisplay').value = data.dateOfReturn;
    }

    // Przypisanie danych JSON do formularza po naciśnięciu przycisku "Next"
    document.getElementById('nextButton').addEventListener('click', function() {
      // Parsowanie danych JSON
      let parsedData = JSON.parse(localStorage['carRentals']) || [];
      // Wyświetlenie danych w formularzu
      console.log(parsedData)
      displayDataInForm(parsedData[carIndex]);
      if (carIndex >=  parsedData.length -1) {
        carIndex = 0;
      } else {
        carIndex++;
      }
    });
    
  </script>
</body>
</html>